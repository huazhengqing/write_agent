# write_agent 2.0: 辩论驱动的创作工作流升级方案

## 1. 背景与目标

当前 `write_agent` v1.0 采用 `Agent -> Reflection` (执行 -> 反思) 的工作流。此模式在实践中暴露出核心问题：单一智能体在执行复杂任务时，容易出现思维盲点，导致初版产出质量不足，后续反思也难以跳出原有框架，整体效率和产出上限受限。

本次升级的目标是引入 **“结构化辩论” (Structured Debate)** 机制，将工作流从“单兵作战”升级为“团队协作”，旨在 **将质量控制前置**，在每个关键产出环节（规划、设计、写作）都通过多角色协作来保证高质量的首次输出，从而系统性地提升创作的全面性、逻辑性和创造性。

## 2. 核心概念：协作单元 (Collaboration Unit)

“协作单元”是一个可复用的、由多个专职智能体组成的协作流程。它将取代当前大部分的 `task_*` -> `task_*_reflection` 调用。根据任务性质，协作单元有多种形态。

### 2.1 标准三角色模型

对于常规任务，辩论单元由以下三个核心角色组成：

- **提议者 (Proposer)**:
  - **职责**: 聚焦“发散思维”，追求广度和速度，产出初稿或多种方案。
  - **产出**: 想法列表、设计草案、写作初稿。

- **批判者 (Critic)**:
  - **职责**: 聚焦“收敛思维”，扮演“魔鬼代言人”，对照上下文和规则进行批判性分析。
  - **产出**: 具体的、可执行的修改意见、风险评估、方案对比。

- **整合者 (Synthesizer)**:
  - **职责**: 聚焦“决策与整合”，权衡各方输入，生成最终的、高质量、格式正确的产物。
  - **产出**: 最终的JSON任务树、设计文档、小说正文。

## 3. 工作流程重构方案

我们将用定制化的“协作单元”替换现有流程中的关键节点。

### 3.1 规划任务 (`plan_*`)

根据任务性质进行差异化处理，取代了统一的 `task_plan_*` -> `task_plan_reflection` 流程。

- **创造性规划 (`plan_design`, `plan_write_to_design`)**: 采用标准**三步辩论**。
  1.  **提议者 (Proposer)**: 快速生成初步的任务分解想法。
  2.  **批判者 (Critic)**: 对想法进行查漏补缺、逻辑排序和优化。
  3.  **整合者 (Synthesizer)**: 将优化后的清单转换为最终的JSON任务树。

- **结构化规划 (`plan_search`)**: 采用高效的**两步协作**。
  1.  **研究规划师 (Planner)**: 结合提议与批判的职责，直接生成一份结构化的研究任务清单草案。
  2.  **格式化工程师 (Synthesizer)**: 将草案精确转换为JSON任务树。

### 3.2 结构规划与写作任务分解 (`hierarchy` & `plan_write_to_write`)

- **流程合并**: 将 `hierarchy` 和 `plan_write_to_write` 合并为一个流程，由 `hierarchy` 协作单元直接输出最终的 `write` 任务JSON树。
- **升级后流程 (三步协作)**:
  1.  **初级架构师 (Proposer)**: 生成初步的、Markdown格式的结构规划草案。
  2.  **首席架构师 (Critic)**: 对草案进行战略性审查，输出Markdown优化指令。
  3.  **规划执行官 (Synthesizer)**: 整合草案和指令，**直接生成最终的JSON任务树**。

### 3.3 设计任务 (`design`)

- **流程演进**: 采用“动态方法论生成”模式，将“对结果的辩论”升维为“对方法的辩论”。
- **升级后流程 (两步协作)**:
  1.  **设计顾问 (Consultant)**: 在动手前，动态生成一份包含第一性原理、创作原则和风险预警的“设计指南”。
  2.  **设计执行官 (Executor)**: 严格遵循“设计指南”，完成最终的高质量设计。

### 3.4 写作任务 (`write`)

- **流程演进**: 采用“四步精修”模式，确保单章写作质量。
- **升级后流程 (四步协作)**:
  1.  **写作前反思 (Before-Reflection)**: 扮演导演角色，生成详细的“分镜脚本”（写作腹稿）。
  2.  **初稿创作者 (Proposer)**: 严格遵循“分镜脚本”，快速生成初稿。
  3.  **首席编辑 (Critic)**: 对照详细清单，对初稿进行微观审查，提出修改意见。
  4.  **精修师 (Synthesizer)**: 根据编辑意见，对初稿进行精准修订，产出最终文稿。

### 3.5 翻译任务 (`translation`)

- **新增流程**: 为小说出海增加“翻译后润色”三步协作流程。
- **流程步骤**:
  1.  **翻译提议者 (Proposer)**: 将中文稿件翻译成英文初稿。
  2.  **母语编辑 (Critic)**: 由英语母语编辑审查英文初稿，提出地道化、文学化的润色建议。
  3.  **母语精修师 (Synthesizer)**: 整合建议，生成最终的、可直接发布的英文版本。

## 4. 高级策略：动态辩论深度

为了平衡成本与质量，系统应能根据任务的重要性动态调整协作的复杂程度。

### 4.1 引入专家角色

对于关键任务，可在标准协作单元基础上，动态引入专家角色：

- **历史学家 (Historian)**: 检查与历史情节、既有设定的连续性。
- **市场分析师 (Market Analyst)**: 评估方案是否符合目标读者偏好和市场趋势。
- **创新者 (Innovator)**: 提出反常规、颠覆性的想法，打破思维定式。

### 4.2 增加辩论轮次

对于最高优先级的任务（如全书大纲、核心转折），可执行多轮辩论：

- **第一轮**: 聚焦结构性、方向性的重大问题。
- **第二轮**: 在第一轮修正稿的基础上，进行细节打磨和精修。

### 4.3 实现逻辑

在 `flow_story_write` 主流程中，增加一个“协作策略选择”步骤。该步骤根据 `task.hierarchical_position` 和 `task.goal` 的关键程度，决定本次任务调用何种协作模型。

## 5. 预期收益

1.  **提升产出质量**: 通过多视角审查和迭代，系统性地减少了规划的疏漏、设计的平庸和写作的瑕疵。
2.  **增强鲁棒性**: 将复杂的单任务分解为简单的多任务，降低了对LLM单次超强发挥的依赖，使系统表现更稳定。
3.  **提高创作上限**: “创新者”等角色的引入，为生成突破性创意提供了可能性。
4.  **成本效益优化**: 通过为不同任务定制最高效的协作流程，并结合“动态深度”策略，确保计算资源能被智能地分配到最关键的创作环节。








分析和改进这套“提议者-批判者-整合者”（Proposer-Critic-Synthesizer）的提示词工作流。


分析和改进这套“提议者-批判者-整合者”（Proposer-Critic-Synthesizer）的提示词工作流。 这是层级结构规划，之后分解为写作子任务的流程。




