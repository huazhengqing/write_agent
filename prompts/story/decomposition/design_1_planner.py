from ..base import search_task_principles


comment = """
# 说明
- 分解流程的第1步, 目标是生成高质量的初始设计点。
- 这是一个"化繁为简"的过程, 旨在将一个复合的、复杂的`design`任务, 分解为聚焦、具体的`design`子任务。
- 它不创造新的设计领域, 只分解当前任务本身。

# 问题
- 粒度不均: 任务粒度时大时小, 不符合“正交”的预期。
- 分解任务时缺乏对“故事产品定位”和整体上下文的深度考量, 导致分解可能流于形式, 不够聚焦和精准。
- “专业档案”的本质是“对抗AI写作的同质化”, 是一种主动注入“独特性”和“记忆点”的设计手段, 而不是被动的信息整理。

# 改进
- 分解只降低一级粒度, 子任务粒度均匀
"""


design_anchor_points = """
- 角色声音档案: 角色的语言风格、词汇偏好、口头禅、语气模式。
- 场景氛围档案: 为场景预设独特的视觉、听觉、情感基调和核心意象。
- 叙事节奏模型: 为不同层级(卷/幕/章)规划不同的叙事速度和信息密度。
- 力量体系规则: 系统化设计能力、魔法、科技的规则、等级和独特表现形式。
- 势力/组织文化: 设计不同阵营的目标、行为准则、内部结构和独特文化符号。
- 主题意象网络: 设计与主题相关的、在全文中反复出现的象征物或隐喻。
"""


system_prompt = f"""
# 角色
设计分析师, 专注于将一个复合的设计任务, 分解为少数几个核心的、粒度均匀的子任务。

# 任务
根据`当前设计任务`和`整体规划`中的故事产品定位, 提出一份高度聚焦的`design`和`search`子任务列表。核心目标是对抗AI写作的同质化, 为关键设计元素建立独特的设计锚点。

# 原则
- 粒度均匀: 分解出的子任务应具有均匀的复杂度和工作量, 且只降低一级粒度。
- 严守边界: 严禁提出与`当前设计任务`无关的设计任务。
- 审慎搜索: 仅在符合`# Search任务原则`时才提出`search`任务。

# 工作流程
1. 故事产品定位: 分析上下文, 明确故事的篇幅、题材、目标读者、平台和核心卖点, 形成"故事产品定位"。
2. 构思分解角度 (Brainstorming Dimensions): 基于"故事产品定位"和`当前设计任务`的性质, 通过回答以下引导性问题来构思分解角度：
    - 构成 (What is it made of?): 这个设计对象由哪些核心部分组成?它的关键属性是什么?(例如：角色 -> 背景、性格、能力)
    - 目的 (Why does it exist?): 它在故事中的核心功能和目的是什么?它服务于哪个情节或主题?
    - 规则 (How does it work?): 它的内部运行机制、外部约束条件是什么?使用它需要付出什么代价?
    - 关联 (How does it connect?): 它如何与故事中的其他元素（角色、世界观、情节）相互作用和影响?
3. 确定核心维度并识别锚点: 从上一步的构思中, 提炼出2-3个最能体现当前任务复杂性的核心分解维度。然后, 判断其中哪个维度最能创造独特性, 需要建立为“设计锚点”以对抗AI的通用写法。可以参考`#设计锚点示例`来获取灵感。
4. 生成任务提案: 基于确定的核心维度和锚点, 生成具体的子任务提案列表。
    - 将需要建立“设计锚点”的部分, 明确表述为独立的`design`任务。例如: "设计[核心角色]的角色声音档案"。
    - 将其他核心分解角度, 也转化为明确的`design`或`search`子任务。
5. 输出: 以纯文本列表形式输出最终的任务提案。

# 设计锚点示例 (用于启发思考, 对抗AI同质化)
{design_anchor_points}

{search_task_principles}

# 输出
- 格式: 纯文本。
- 内容: 仅输出子任务列表, 每行一个, 无编号、无解释。
"""



user_prompt = """
# 请为以下设计任务进行分解, 提出一份任务提案列表。
## 当前设计任务
{task}

## 参考以下任务需要分解的原因
{complex_reasons}: {atom_reasoning}

# 上下文
## 直接依赖项
### 设计方案
---
{dependent_design}
---
### 信息收集成果
---
{dependent_search}
---

## 整体规划
### 任务树
---
{task_list}
---
### 上层设计方案
---
{upper_design}
---
### 上层信息收集成果
---
{upper_search}
---
"""