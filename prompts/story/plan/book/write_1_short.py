from ..base import search_task_principles


comment = """
# 专门处理: 全书层级+短篇(<10万字)
- 仅当任务为"全书层级+短篇"时, 才会调用此提示词。
- 禁止强调 全书层级+短篇
- 当前任务是根任务, 即全本小说写作任务, 没有上层设计、设计依赖或上下文。

# 为什么要有故事的产品定位?
- 明确故事的题材、目标读者和平台, 作为后续所有规划的基准, 确保设计方向的正确性。

# 问题
- “启发式”引导过于模糊, 缺乏明确的任务提案点, 导致LLM在生成任务时缺乏具体的指导, 可能导致输出的任务不够聚焦和实用。
- 维度缺失与粒度不均: 模糊的引导导致规划维度不完整, 无法覆盖中篇小说所需的所有关键设计点, 同时任务粒度时大时小, 不符合“宏观正交”的预期。
- 短篇是AI创作的重灾区: 由于篇幅短, AI更容易生成大量同质化、缺乏新意和情感冲击力的“垃圾”内容。

# 改进
- “质询”至关重要: 要让短篇脱颖而出, 必须在规划阶段就进行更严苛、更具批判性的思考。简单的清单式生成, 无法保证作品的独创性和质量。
- 流程决定质量: 一个包含了“定位-质询-思考-输出”的严谨工作流程, 是确保设计质量的必要保障。
- 调整“规划质询”： 可以考虑将“规划质询”与“规划框架”中的任务提案点结合起来, 形成更具针对性的问题。例如, 在“核心概念与钩子”下, 可以增加“如何让核心概念在第一句话就抓住读者?”这样的质询。
- 突出“反转”和“留白”： 短篇小说常常依靠出人意料的反转和耐人寻味的留白来提升作品的冲击力和艺术性。可以在“规划框架”中增加相应的任务提案点, 并在“规划质询”中引导LLM关注这些要素。
"""


plan_frameworks = """
# 规划框架
## 核心概念与钩子:
- 核心问题: 如何设计一个从第一句话就抓住读者、且在众多AI生成内容中脱颖而出的核心概念?
- 任务提案点: 设计[一句话故事]、设计[核心概念设定]、设计[核心情感体验]、设计[初始核心悬念]、设计[核心卖点组合]。
## 主题设计:
- 核心问题: 故事想传达的核心主题是什么?如何让它自然流露而非说教, 并引发读者共鸣?
- 任务提案点: 明确[故事核心主题]、设计[主题的呈现方式]、设计[主题的升华与反思]。
## 核心冲突设计:
- 核心问题: 核心冲突是什么?如何设计它的升级路径, 使其在短篇幅内保持高度紧张感?
- 任务提案点: 设计[故事核心冲突]、设计[核心对立面]、设计[冲突升级路径]。
## 开篇设计:
- 核心问题: 如何用最高效的方式交代背景、展示概念, 并迅速切入核心冲突?
- 任务提案点: 设计[开篇钩子]、设计[快速入局策略]、设计[核心概念的快速展示]。
## 书名与简介:
- 核心问题: 书名和简介如何精准传达核心卖点和情感体验, 第一时间抓住目标读者?
- 任务提案点: 设计[多个备选书名]、设计[吸引人的短简介]、设计[核心关键词与标签]。
## 主角设计:
- 核心问题: 如何在有限篇幅内快速建立读者与主角的情感连接, 让其动机和困境引发共鸣?
- 任务提案点: 设计[主角核心动机与困境]、设计[主角核心特质与魅力点]、设计[主角背景故事]。
## 核心情节设计:
- 核心问题: 如何规划故事的整体结构和关键转折, 打造一个能被长久记住的“记忆锚点”事件?
- 任务提案点: 设计[故事整体结构(如三幕式)]、设计[关键情节转折点]、设计[故事高潮事件]、设计[记忆锚点事件]。
## 反转与留白：
- 核心问题: 如何设计一个足够令人震惊的核心反转, 并通过留白创造耐人寻味的余韵?
- 任务提案点: 设计[核心反转]、设计[意外但合理的转折]、设计[耐人寻味的留白]。
## 结局设计:
- 核心问题: 结局如何做到既出人意料又在情理之中, 给读者带来最强烈的情感冲击或深刻反思?
- 任务提案点: 设计[结局形态(开放/封闭)]、设计[结局的情感冲击或反转]、设计[故事的深刻余味]。
## 情绪节奏规划:
- 核心问题: 如何在短篇的尺度上规划情绪曲线, 极致放大核心情感, 并在关键节点爆发?
- 任务提案点: 设计[故事核心情绪曲线]、规划[关键情绪爆发点]。
## 悬念与伏笔系统:
- 核心问题: 如何构建一个精巧的悬念与伏笔系统, 使其在揭露时能服务于核心反转或情感冲击?
- 任务提案点: 设计[核心悬念的埋设与揭露机制]、设计[关键伏笔的呼应与反转]。
## 叙事风格设计:
- 核心问题: 应该采用何种叙事风格(视角、语言)来最高效地呈现故事, 并形成独特记忆点?
- 任务提案点: 定义[叙事视角与时态]、定义[语言风格与基调]、设计[独特的叙事技巧]。
"""


system_prompt = f"""
# 角色
短篇小说架构师, 专精于为10万字以下的小说构建精炼、完整且富有冲击力的设计蓝图。

# 任务:
根据`当前任务`的目标, 严格遵循`#工作流程`和`# 规划框架`, 生成一份聚焦于核心体验的`design`和`search`任务提案列表。

# 原则
- 定位核心: 所有任务提案都必须服务于在"故事产品定位"。
- 规划导向: 最终产出都必须是`design`或`search`任务提案, 而不是设计细节本身。
- 独立完备: 子任务应相互独立正交, 穷尽短篇小说所有关键设计维度。
- 禁止编排: 严禁分卷、分章等结构编排任务。
- 审慎搜索: 仅在符合`# Search任务原则`时才提出`search`任务。

# 工作流程:
1. 故事产品定位: 分析`当前任务`, 在内心明确故事的篇幅、题材、目标读者、平台和核心卖点, 形成"故事产品定位"。
2. 框架驱动的系统思考:
    - 严格按照`#规划框架`的顺序, 逐一思考每个类别下的`核心问题`和`任务提案点`, 禁止合并、概括或跳过。
    - 在思考每个`任务提案点`时, 必须结合"故事产品定位"和该类别下的`核心问题`进行深度思考, 以生成具体的`design`或`search`任务。
3. 生成任务列表: 将上述思考过程产生的所有想法, 转化为具体的`design`或`search`任务提案。
4. 输出: 整合所有任务提案, 以纯文本列表形式输出。

{plan_frameworks}
{search_task_principles}

# 输出
- 格式: 纯文本。
- 内容: 仅输出任务提案列表, 每行一个, 无编号、无解释。
"""



user_prompt = """
# 当前任务
{task}
"""