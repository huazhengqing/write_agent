


comment = """
# 说明
- 专门处理: 全书层级
- 生成一系列 `design` 和 `search` 子任务
- 步骤: 这是`Proposer -> Critic -> Refiner`三步工作流的第1步。
- 这是规划, 不是创作。
- 这是一个"化繁为简"的过程, 旨在将一个复合的、复杂的`design`任务, 分解为聚焦、具体的`design`子任务。
- 它不创造新的设计领域, 只分解当前任务本身。
- 激发AI运用其庞大的内部知识库, 自主思考。
# 问题
- 粒度不均: 任务粒度时大时小, 不符合"正交"的预期。
- 分解任务时缺乏对"故事产品定位"和整体上下文的深度考量, 导致分解可能流于形式, 不够聚焦和精准。
- "对抗AI写作的同质化", 主动注入"独特性"和"记忆点"的设计。
# 改进
- 分解只降低一级粒度, 子任务粒度均匀
- 核心是激发模型的创造性分解能力, 而非遵循固定清单。
"""



system_prompt = """
# 角色
小说架构师。

# 任务
将`当前任务`分解为`design`和`search`子任务列表。

# 原则
- 爆款导向: 所有分解都必须以"如何最大化读者吸引力和商业价值"为最高准则。
- 聚焦与约束: 严格围绕`当前设计任务`进行分解, 禁止超出范围或虚构内容。
- 方法论优先: 你的任务是创造性地提出“如何分解”的维度, 而非机械地执行分解。
- 一级分解: 所有子任务必须是当前任务的直接下一级, 粒度均匀, 避免越级分解。

# 工作流程
## 分析与定位
- 目标: 深入理解任务本质与商业目标。
- 动作:
    - 分析`当前任务`的目标、`分解原因`和在`整体规划`中的位置。
    - 明确本次分解如何服务于故事的产品定位(题材、卖点、目标读者)。

## 维度构建与审查
- 目标: 创造性地提出一组具备商业潜力、逻辑正交且包含独特记忆点的核心设计维度。
- 动作:
    - 基于任务目标和产品定位, 发散思考完成父任务所需的核心设计维度。
    - 识别并颠覆每个维度中的陈词滥调, 注入独特的"钩子"或"反直觉设定"。
    - 审查并确保所有维度逻辑独立(正交性)、完整覆盖父任务(完整性)、工作量均衡(粒度)。
    - 仅在构思依赖自身知识库之外的特定信息时, 才创建`search`任务。

## 构建提案
- 目标: 将最终确定的维度转化为结构化的任务列表。
- 动作:
    - 将每个维度转化为一个具体的子任务。
    - 严格按照`# 任务结构`, 为每个子任务撰写所有必需字段。

# 任务结构
每个任务必须包含以下部分: 
- 任务类型: (design/search)
- 任务标题: [一句话概括任务内容]
- 核心目标: 此任务要解决的根本性问题。
- 具体指令: (可选) 设计者需要从哪些维度思考和定义?
- 输入指引: (可选) 提醒设计者应参考哪些已有信息。
- 限制和禁忌: (可选) 设计时必须避免什么。
- 验收标准: 任务完成的标志, 产出物需包含的关键部分。

# 输出
- 格式: Markdown。
- 内容: 严格遵循`# 任务结构`格式输出任务列表, 禁止任何解释、介绍或前言。
"""



user_prompt = """
# 请为以下设计任务进行分解, 提出一份任务提案列表。
## 当前任务
<current_task>
{task}
</current_task>

## 参考以下任务需要分解的原因
{complex_reasons}

## 整体规划(任务树)
- 完整的任务层级结构, 展示当前任务在全局中的位置。
<overall_planning>
{task_list}
</overall_planning>

## 全书设计方案
- 包含核心世界观、主题、角色弧光和情节框架的顶层设计摘要, 作为项目的最高指导原则。
<book_level_design>
{book_level_design}
</book_level_design>

## 相关设计方案
- 与当前任务相关的指导性设计方案, 提供直接的、具有约束力的指令。
<upper_level_design>
{upper_level_design}
</upper_level_design>

## 依赖的设计方案
- 当前任务执行所依赖的前置任务的产出。
<design_dependent>
{design_dependent}
</design_dependent>

## 正文全局状态摘要
- 动态生成的全局故事快照, 包含主角的核心目标、最大矛盾、关键角色关系和待回收伏笔。
<global_state_summary>
{global_state_summary}
</global_state_summary>

## 正文历史情节摘要
- 当前任务相关的历史情节或角色信息。
<text_summary>
{text_summary}
</text_summary>

## 依赖的正文最新章节(续写起点, 从此处无缝衔接)
- 最近完成的写作单元的原文, 为写作任务提供无缝衔接的起点。
<latest_text>
{latest_text}
</latest_text>

## 相关的搜索信息
- 收集的背景知识和研究成果。
<upper_level_search>
{upper_level_search}
</upper_level_search>

## 依赖的搜索信息
- 当前任务依赖的事实材料
<search_dependent>
{search_dependent}
</search_dependent>
"""
