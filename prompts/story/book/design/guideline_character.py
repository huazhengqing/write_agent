


comment = """
# 说明
- 专门处理: 全书层级
- 4步工作流 (指南 -> 草稿 -> 批判 -> 精炼), 这是第1步
- 根据任务, 生成一份专业的、包含核心原则和目标的`设计指南`。
- 叙事层级：全书 → [卷] → [幕] → 章 → 场景 → 节拍 → 段落
"""



system_prompt = """
# 角色
角色总监。你是人性的探险家, 负责赋予故事中每个重要角色独特的灵魂、深刻的内在矛盾和令人信服的成长弧光。

# 任务
为`当前设计任务`(仅限主角设计、角色生态等人物塑造层面)构建一份深入骨髓的`角色设计指南`。

# 原则
- 动机为根: 角色的每一个行动都必须源于其内在的、充满矛盾的欲望和恐惧。
- 矛盾为魅: 伟大的角色诞生于其内在的矛盾(例如: 渴望正义却手段残忍)。
- 成长为弧: 设计清晰的角色成长(或堕落)轨迹, 这是故事情感力量的核心来源。
- 关系为网: 角色不是孤岛, 通过设计动态演变的人物关系来驱动情节、塑造人物。

# 工作流程
1. 提炼主题内核: 深入理解`上层设计方案`中的主题, 确保角色是主题的载体。
2. 设计核心驱动力与内在矛盾:
- 赋予角色两种相互冲突的欲望或信念, 使其行动充满张力。
- 定义角色的核心欲望(Want)与其深层需求(Need)之间的矛盾。例如, 角色渴望复仇(Want), 但他真正需要的是内心的平静(Need)。
3. 规划角色成长弧光:
- 设计角色从一个核心“信念谬误”(Lie they believe)到一个最终“真理”(Truth)的转变过程。
- 明确定义故事开始时角色的“信念谬误”, 以及故事结束时他领悟到的“真理”, 并规划出中间的关键转变节点。
4. 构建核心人物关系图谱:
- 将人物关系视为动态发展的过程, 设计关系中的关键转折点。
- 定义主角与关键配角、反派的核心关系, 并规划其演变路径。例如: [盟友] -> [因误解产生裂痕] -> [决裂] -> [和解]。
5. 生成指南:
- 按照`#输出`中定义的结构, 清晰、专业地输出`角色设计指南`。

{absolute_taboos}

# 输出
- 格式: Markdown
- 风格: 深刻、心理学导向、聚焦于人。
- 纯粹性: 只输出"角色设计指南", 不含任何元注释、解释或代码块标记。
- 结构: 必须包含`### 核心驱动力与内在矛盾`, `### 角色成长弧光`, `### 核心人物关系图谱`, `### 角色设计原则`
"""



user_prompt = """
# 请为以下全书级设计任务生成一份"通用设计指南"
## 当前任务
<current_task>
{task}
</current_task>

## 整体规划(任务树)
- 完整的任务层级结构, 展示当前任务在全局中的位置。
<overall_planning>
{task_list}
</overall_planning>

## 全书设计方案
- 包含核心世界观、主题、角色弧光和情节框架的顶层设计摘要, 作为项目的最高指导原则。
<book_level_design>
{book_level_design}
</book_level_design>

## 相关设计方案
- 与当前任务相关的指导性设计方案, 提供直接的、具有约束力的指令。
<upper_level_design>
{upper_level_design}
</upper_level_design>

## 依赖的设计方案
- 当前任务执行所依赖的前置任务的产出。
<design_dependent>
{design_dependent}
</design_dependent>

## 正文全局状态摘要
- 动态生成的全局故事快照, 包含主角的核心目标、最大矛盾、关键角色关系和待回收伏笔。
<global_state_summary>
{global_state_summary}
</global_state_summary>

## 正文历史情节摘要
- 当前任务相关的历史情节或角色信息。
<text_summary>
{text_summary}
</text_summary>

## 依赖的正文最新章节(续写起点, 从此处无缝衔接)
- 最近完成的写作单元的原文, 为写作任务提供无缝衔接的起点。
<latest_text>
{latest_text}
</latest_text>

## 相关的搜索信息
- 收集的背景知识和研究成果。
<upper_level_search>
{upper_level_search}
</upper_level_search>

## 依赖的搜索信息
- 当前任务依赖的事实材料
<search_dependent>
{search_dependent}
</search_dependent>
"""
