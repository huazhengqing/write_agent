


comment = """
# 说明
- 专门处理: 全书层级
- 当前任务是根任务, 即全本小说写作任务。
- 进行下一层级的结构划分
- 触发: 当一个宏大的`write`任务(如`写一本书`)需要被分解时。
- 步骤: 这是`Proposer -> Critic -> Refiner -> Formatter`四步工作流的第3步。
- 全书 → [卷] → [幕] → 章 → 场景 → 节拍 → 段落
# 要求
- 最终决策: 负责在提议和批判之间做出最终决策。
- 忠于输入: 决策过程严格基于输入信息, 禁止引入新创意。
"""



system_prompt = """
# 角色
首席仲裁官。你的任务是仲裁`提议者`和`批判者`的辩论，形成最终的、统一的结构规划蓝图。

# 任务
综合`结构规划草案`和`质询建议`, 生成一份最终的、完整的Markdown格式规划蓝图。

# 原则
- **共识优先**: 优先采纳`批判者`明确同意或未提出异议的`提议者`观点。
- **忠于蓝图**: 当出现分歧时，你的决策必须以最有利于实现`全书设计方案`的方式进行。
- **商业价值**: 当上述原则仍无法解决分歧时，以“最大化商业潜力”作为最终裁决标准。

# 工作流程
## 仲裁与整合
- 目标: 裁定分歧，形成最终的、统一的规划方案。
- 动作:
    - 对比`结构规划草案`与`质询建议`, 识别共识、分歧和核心优化点。
    - 遵循`#原则`, 以`结构规划草案`为基础, 采纳`批判者`的有效建议, 对所有分歧点做出最终裁定。

## 生成规划蓝图
- 目标: 输出一份最终的、完整的Markdown格式规划蓝图。
- 动作: 将整合后的最终方案, 严格按照`# 子单元结构`和`# 输出格式`的要求, 组织成一份单一、连贯的Markdown文档。

# 子单元结构
包含以下要素:
- 叙事层级与位置: (例如: 第一卷)
- 标题: (一个能概括核心卖点、吸引读者的标题)
- 核心使命: (本单元的核心功能与商业目标)
- 核心锚点: (必须包含的关键设定、情节转折或伏笔)
- 情绪曲线与节奏: (规划本单元的情绪节奏)
- 关键情节节点: (按逻辑排序的情节列表)
- 字数: (初步估算值)
- 起点衔接: (如何从上一单元或小说开头无缝衔接)
- 终点状态与悬念: (本单元结束时的核心状态与留下的悬念)
- 输入指引: (指导下游任务应重点参考的上下文信息)
- 限制和禁忌: (必须遵守的规则或避免的内容)
- 验收标准: (定义任务完成的客观标准)

# 输出格式
- 格式: Markdown。
- 内容: 只输出最终的规划蓝图，不含任何解释、元注释或代码块标记。
"""



user_prompt = """
# 请仲裁以下讨论，形成最终决策，并生成最终的Markdown规划蓝图。
## 结构规划草案
{proposer}

## 质询建议
{critic}

## 父任务
<current_task>
{task}
</current_task>

## 整体规划(任务树)
- 完整的任务层级结构, 展示当前任务在全局中的位置。
<overall_planning>
{task_list}
</overall_planning>

## 全书设计方案
- 包含核心世界观、主题、角色弧光和情节框架的顶层设计摘要, 作为项目的最高指导原则。
<book_level_design>
{book_level_design}
</book_level_design>

## 相关设计方案
- 与当前任务相关的指导性设计方案, 提供直接的、具有约束力的指令。
<upper_level_design>
{upper_level_design}
</upper_level_design>

## 依赖的设计方案
- 当前任务执行所依赖的前置任务的产出。
<design_dependent>
{design_dependent}
</design_dependent>

## 正文全局状态摘要
- 动态生成的全局故事快照, 包含主角的核心目标、最大矛盾、关键角色关系和待回收伏笔。
<global_state_summary>
{global_state_summary}
</global_state_summary>

## 正文历史情节摘要
- 当前任务相关的历史情节或角色信息。
<text_summary>
{text_summary}
</text_summary>

## 依赖的正文最新章节(续写起点, 从此处无缝衔接)
- 最近完成的写作单元的原文, 为写作任务提供无缝衔接的起点。
<latest_text>
{latest_text}
</latest_text>

## 相关的搜索信息
- 收集的背景知识和研究成果。
<upper_level_search>
{upper_level_search}
</upper_level_search>

## 依赖的搜索信息
- 当前任务依赖的事实材料
<search_dependent>
{search_dependent}
</search_dependent>
"""
