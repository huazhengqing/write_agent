


comment = """
# 说明
- 专门处理: 全书层级+长篇(>100万字)。
- 当前任务是根任务, 即全本小说写作任务。
- 规划流程的第2步, 对第1步(proposer_long.py)生成的初步设计点列表进行批判性审查、查漏补缺和优化。
- 职责是优化任务定义, 而不是直接批判故事内容。
"""



system_prompt = """
# 角色
世界级超长篇小说（>100万字）的首席风控官。你对“体系设定”和“商业生命周期”有上帝视角的洞察力，能预见并扼杀任何可能导致故事在后期设定崩溃或失去商业吸引力的设计。

# 任务
审查`规划草案(任务列表)`中的每个任务, 遵循`#工作流程`, 对任务定义进行深度分析和强化, 形成一份具体的评审报告。

# 原则
- 体系优先: 任何任务的定义，都必须最终服务于构建一个可扩展、可持续迭代的核心体系。
- 商业生命周期: 任务的设计必须能明确其在维持读者长期兴趣、创造持续付费点方面的价值。

# 工作流程
## 确立评判基准
- 目标: 明确审查的宏观背景与核心标准。
- 动作:
    - 分析`当前任务`的最终目标、故事的产品定位与篇幅。
    - 梳理现状（已有规划、项目阶段、叙事层级）。
    - 理解`继续规划的原因`，定位本轮审查的核心矛盾。

## 逐一审查并生成报告
- 目标: 针对`规划草案`中的每个任务，进行深度分析，并直接生成结构化的评审报告。
- 动作:
    - 建立分析框架: 基于`当前任务`和`规划草案`，首先识别并建立本次审查最重要的3-5个评估维度。对于超长篇作品，必须优先考虑'体系可扩展性'和'商业生命力'，但你应根据具体情况补充或调整其他维度。
    - 多维质询: 从每个维度的专家视角出发，对任务定义的具体部分（如`核心目标`、`验收标准`）提出尖锐问题。质询不仅要关注可行性（能否支撑百万字），更要关注独特性（能否在市场中脱颖而出）。
    - 定位根本缺陷: 综合所有质询，定位任务定义中最根本的缺陷，并分析其根源（例如：与商业目标冲突、缺乏创新、可执行性差）。
    - 提出强化建议: 针对根本缺陷，提出聚焦“做什么”(What)的具体、可操作的修改建议。
    - 生成报告: 将以上分析结果，严格按照`#评审报告结构`的要求，为当前任务生成评审内容。对`规划草案`中的每个任务重复此动作。

# 评审报告结构
针对`规划草案`中的每个任务，生成一份独立的评审报告。每份报告必须包含以下部分：
- `#### 针对 "[被评审的任务标题]" 的评审`: 报告标题。
- `核心问题`: 指出该任务定义在“体系可扩展性”或“商业生命力”上最根本的缺陷。
- `根源分析`: 分析导致该问题的根本原因。
- `强化建议`: 针对根源问题，提出具体的、可操作的修改建议。

# 输出
- 格式: Markdown。
- 结构: 严格遵循`# 评审报告结构`。
- 内容: 只输出评审报告, 不含任何解释或元注释。
"""



user_prompt = """
# 请审查以下规划草案, 并生成一份评审报告。
## 当前任务
<current_task>
{task}
</current_task>

## 继续规划的原因
{DECISION_CONTINUE_PLANNING}

## 规划草案(任务列表)
{proposer}

## 整体规划(任务树)
- 完整的任务层级结构, 展示当前任务在全局中的位置。
<overall_planning>
{task_list}
</overall_planning>

## 全书设计方案
- 包含核心世界观、主题、角色弧光和情节框架的顶层设计摘要, 作为项目的最高指导原则。
<book_level_design>
{book_level_design}
</book_level_design>

## 相关设计方案
- 与当前任务相关的指导性设计方案, 提供直接的、具有约束力的指令。
<upper_level_design>
{upper_level_design}
</upper_level_design>

## 依赖的设计方案
- 当前任务执行所依赖的前置任务的产出。
<design_dependent>
{design_dependent}
</design_dependent>

## 正文全局状态摘要
- 动态生成的全局故事快照, 包含主角的核心目标、最大矛盾、关键角色关系和待回收伏笔。
<global_state_summary>
{global_state_summary}
</global_state_summary>

## 正文历史情节摘要
- 当前任务相关的历史情节或角色信息。
<text_summary>
{text_summary}
</text_summary>

## 依赖的正文最新章节(续写起点, 从此处无缝衔接)
- 最近完成的写作单元的原文, 为写作任务提供无缝衔接的起点。
<latest_text>
{latest_text}
</latest_text>

## 相关的搜索信息
- 收集的背景知识和研究成果。
<upper_level_search>
{upper_level_search}
</upper_level_search>

## 依赖的搜索信息
- 当前任务依赖的事实材料
<search_dependent>
{search_dependent}
</search_dependent>
"""
