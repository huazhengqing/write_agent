

kg_extraction_prompt_design = """
# 任务
从“设计文档”中提取实体和关系, 输出为纯JSON。

# Schema
## 节点标签 (Label)
- `角色设计`: 代表“角色设计文档”或“角色卡”本身, 是一个元数据节点。
- `角色`: 代表故事中实际出现的、可行动的人物实体。属性应包含: `核心动机`, `童年创伤`, `性格标签`, `内在矛盾`。
- `情节单元`: 故事大纲模块 (卷、幕、章)。
- `物品设定`: 特殊道具设计。
- `地点`: 故事场所。
- `组织`: 团体、势力。
- `设定/概念`: 世界背景、核心创意、主题、规则。
- `能力`: 角色掌握的技能或特殊力量。

## 关系标签 (Label)
- `依赖于`
- `包含`
- `属于`
- `细化为`
- `正向影响`
- `负向影响`
- `初始关系为`
- `发生在`
- `定义了`
- `设定了`
- `拥有能力`

# 输出规则
- 格式: 纯JSON对象 `{{"nodes": [...], "edges": [...]}}`。
- 节点ID: 必须使用实体原始中文名。
- 别名处理: 别名或昵称需统一为标准名ID。
- 属性提取: 尽可能从文本中提取实体的关键属性 (如 `背景`, `设计理念`) 并放入 `properties` 字段。
- 约束: 节点ID唯一, 关系必须连接已定义节点。

# 示例
- 输入事实 1 (角色卡):
    "角色设计文档: [角色名]。背景: [背景设定]。核心能力: [核心能力]。设计理念: [设计理念]。"
- 输出JSON 1:
    {{
        "nodes": [
            {{"id": "[角色名]的设计文档", "label": "角色设计", "properties": {{"name": "[角色名]的设计文档", "设计理念": "[设计理念]"}}}},
            {{"id": "[角色名]", "label": "角色", "properties": {{"name": "[角色名]", "背景": "[背景设定]", "核心动机": "[动机]", "内在矛盾": "[矛盾描述]", "性格标签": "标签1, 标签2"}}}},
            {{"id": "[核心能力]", "label": "能力", "properties": {{"name": "[核心能力]"}}}}
        ],
        "edges": [
            {{"source": "[角色名]的设计文档", "target": "[角色名]", "label": "定义了", "properties": {{}}}},
            {{"source": "[角色名]", "target": "[核心能力]", "label": "拥有能力", "properties": {{}}}}
        ]
    }}
- 输入事实 2 (大纲):
    "故事大纲分为[第一卷]和[第二卷]。[第一卷]包含[第一章]和[第二章]。在[第一章]中, [角色A]与[角色B]的相遇, 对[角色A]的成长产生了[正向影响]。"
- 输出JSON 2:
    {{
        "nodes": [
            {{"id": "[第一卷]", "label": "情节单元", "properties": {{"name": "[第一卷]"}}}},
            {{"id": "[第二卷]", "label": "情节单元", "properties": {{"name": "[第二卷]"}}}},
            {{"id": "[第一章]", "label": "情节单元", "properties": {{"name": "[第一章]"}}}},
            {{"id": "[第二章]", "label": "情节单元", "properties": {{"name": "[第二章]"}}}},
            {{"id": "[角色A]", "label": "角色", "properties": {{"name": "[角色A]"}}}},
            {{"id": "[角色B]", "label": "角色", "properties": {{"name": "[角色B]"}}}}
        ],
        "edges": [
            {{"source": "[第一卷]", "target": "[第一章]", "label": "包含", "properties": {{}}}},
            {{"source": "[第一卷]", "target": "[第二章]", "label": "包含", "properties": {{}}}},
            {{"source": "[角色B]", "target": "[角色A]", "label": "正向影响", "properties": {{"summary": "相遇事件影响了角色A的成长"}}}}
        ]
    }}

---
现在, 为以下设计文档提取图谱数据。禁止任何解释, 只输出纯JSON。
{context_str}
"""


###############################################################################


kg_extraction_prompt_write = """
# 任务
从“小说正文”中提取实体和关系, 重点捕捉动态关系、因果链和状态变化。输出为纯JSON。

# Schema
## 节点标签 (Label)
- `角色`: 人物。属性可包含: `性格标签`, `童年创伤`。
- `地点`: 场所。
- `事件`: 导致关键实体状态发生显著变化的行动或时刻。
- `物品`: 特殊道具。
- `组织`: 团体、势力。
- `角色状态`: 角色在特定时间点的状态快照。
    - properties: `attribute` (如: 健康, 情绪, 位置), `value` (如: 重伤, 愤怒, '风语镇'), `timestamp`, `context`。
- `目标/动机`: 角色的目标或动机。
- `信念/知识`: 角色相信或知道的信息。
- `线索`: 悬疑、解谜情节的关键线索。
- `设定/概念`: 世界观、物理法则、社会规范。

## 关系标签 (Label)
- 静态: `拥有`, `使用`, `位于`, `属于`, `朋友`, `敌人`, `师徒`, `亲人`
- 动态与因果: `前往`, `离开`, `遇见`, `对话`, `攻击`, `触发`, `参与`, `导致`, `改变了`, `具有状态`, `拥有目标`, `持有信念`, `发现`, `关联到`, `受...影响`, `包含`

# 输出规则
- 格式: 纯JSON对象 `{{"nodes": [...], "edges": [...]}}`。
- 节点ID: 必须使用实体原始中文名。
- 别名处理: 别名或昵称需统一为标准名ID。
- 时间戳: `timestamp` 应记录事件发生的上下文, 如"第X章"或"场景Y"。
- 关系属性: 对于 `对话`, `攻击` 等动态关系, 可在 `properties` 中添加 `summary` 或 `outcome` 字段以提供更多细节。
- 事件定义: 只有导致关键实体状态发生显著变化的行动, 才应被定义为一个独立的 `事件` 节点。简单的动作 (如“走路”) 不应成为事件。
- 状态变化建模:
    - 状态用 `角色状态` 节点表示。例如, `{"id": "角色A的健康状态:重伤", "label": "角色状态", "properties": {"attribute": "健康", "value": "重伤"}}`。
    - 状态的改变通过 `改变了` 关系连接 `事件` 和 `角色状态` 来表示。例如, `[事件:战斗] -改变了-> [角色状态:角色A的健康状态:重伤]`。
- 约束: 节点ID唯一, 关系必须连接已定义节点。

# 示例
- 输入事实:
    "在[时间/章节], 为了[核心动机], [角色A]来到了[地点A]。他发现一条线索: '[线索内容]'。据此, [角色A]产生了'[某个信念]'。这个信念导致他决定[某个行动], 但行动受到了'[某个规则]'的阻碍。在行动中, [角色A]的健康状态从'完好'变为'重伤'。"
- 输出JSON:
    {{
        "nodes": [
            {{"id": "[角色A]", "label": "角色", "properties": {{"name": "[角色A]", "性格标签": "坚韧, 孤独"}}}},
            {{"id": "[地点A]", "label": "地点", "properties": {{"name": "[地点A]"}}}},
            {{"id": "[核心动机]", "label": "目标/动机", "properties": {{"name": "[核心动机]"}}}},
            {{"id": "[线索内容]", "label": "线索", "properties": {{"name": "[线索内容]"}}}},
            {{"id": "[某个信念]", "label": "信念/知识", "properties": {{"name": "[某个信念]"}}}},
            {{"id": "[某个行动]", "label": "事件", "properties": {{"name": "[某个行动]", "timestamp": "[时间/章节]"}}}},
            {{"id": "[某个规则]", "label": "设定/概念", "properties": {{"name": "[某个规则]"}}}},
            {{"id": "角色A的健康状态:完好", "label": "角色状态", "properties": {{"name": "角色A的健康状态:完好", "attribute": "健康", "value": "完好"}}}},
            {{"id": "角色A的健康状态:重伤", "label": "角色状态", "properties": {{"name": "角色A的健康状态:重伤", "attribute": "健康", "value": "重伤"}}}}
        ],
        "edges": [
            {{"source": "[角色A]", "target": "[核心动机]", "label": "拥有目标", "properties": {{}}}},
            {{"source": "[角色A]", "target": "[地点A]", "label": "位于", "properties": {{"timestamp": "[时间/章节]"}}}},
            {{"source": "[角色A]", "target": "[线索内容]", "label": "发现", "properties": {{}}}},
            {{"source": "[角色A]", "target": "[某个信念]", "label": "持有信念", "properties": {{"reason": "基于[线索内容]"}}}},
            {{"source": "[某个信念]", "target": "[某个行动]", "label": "导致", "properties": {{}}}},
            {{"source": "[某个行动]", "target": "[某个规则]", "label": "受...影响", "properties": {{"summary": "行动受到阻碍"}}}},
            {{"source": "[某个行动]", "target": "角色A的健康状态:重伤", "label": "改变了", "properties": {{"from": "角色A的健康状态:完好"}}}}
        ]
    }}

---
现在, 为以下小说正文提取图谱数据。禁止任何解释, 只输出纯JSON。
{context_str}
"""
